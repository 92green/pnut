general:
  branches:
    ignore:
      - gh-pages
machine:
    pre:
        - mkdir ~/.yarn-cache
    node:
        version: stable
    environment:
        YARN_VERSION: 0.17.10
        PATH: "${PATH}:${HOME}/.yarn/bin"

dependencies:
    pre:
        - |
            if [[ ! -e ~/.yarn/bin/yarn || $(yarn --version) != "${YARN_VERSION}" ]]; then
                curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version $YARN_VERSION
            fi
    cache_directories:
        - ~/.yarn
        - ~/.yarn-cache
    override:
        - yarn install --no-progress
        - node node_modules/node-sass/scripts/install.js # Force node sass to build vendor file to avoid this issue: https://github.com/sass/node-sass/issues/1579
test:
    override:
        - yarn run test-all
deployment:
    master:
        branch: master
        owner: bigdatr
        commands:
            - git config --global user.email stampy@bigdatr.com
            - git config --global user.name bigdatrbots
            - yarn run deploy-to-gh-pages
